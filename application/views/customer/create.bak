<?php
// Copyright (C) 2002-2004  Paul Yasi <paul@citrusdb.org>, read the README file for more information

//
// make a new empty customer record
//
$query = "INSERT into customer (signup_date) VALUES (CURRENT_DATE)";
$result = db_query($query) or die ("Query Failed $query"); 
$myinsertid = db_insertid();  // is this the upcoming insert, not the previous one?
$account_number=$myinsertid;

//
// start the session variables to hold the account number
//
session_start();
$_SESSION['account_number'] = $account_number;

//
// get the current date and time in the SQL query format
//


//
// check if it's after the dayrollover time and get tomorrow's date
//


//
// check if the date is in the holiday table, move up one day until not matched
//


//
// set the next billing date and from date to the date determined from above for the first billing
//
$query = "INSERT into billing (account_number,next_billing_date,from_date) VALUES ('$account_number',CURRENT_DATE,CURRENT_DATE)";
$result = db_query($query) or die ("Query Failed $query");	


//
// set the default billing ID for the customer record
//
$billingid = db_insertid ();
$query = "UPDATE customer SET default_billing_id = '$billingid' WHERE account_number = $account_number";
$result = db_query($query) or die ("Query Failed $query");	

print "<script language=\"JavaScript\">window.location.href = \"main.php?load=customer&type=module&edit=on\";</script>";
?>
